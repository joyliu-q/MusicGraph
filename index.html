<html>
<head>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <style type="text/css">
        #musicNetwork {
            width: auto;
            height: 500px;
            border: 1px solid lightgray;
        }
        #instructionText {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <span id="instructionText">Instructions: Blah</span>
        <!-- Note Editor Modal -->
        <div class="modal fade"
        id="noteModal" 
        tabindex="-1" 
        role="dialog" 
        aria-labelledby="exampleModalLabel" 
        aria-hidden="true"
        >
        <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Please select note details</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
            </div>
            <div class="modal-body">
                <span>Music Note:</span>
                <div id="noteButtons" class="btn-group btn-group-toggle" role="group">
                    <button onclick="selectNote('A')" class="btn btn-secondary">A</button>
                    <button onclick="selectNote('B')" class="btn btn-secondary">B</button>
                    <button onclick="selectNote('C')" class="btn btn-secondary">C</button>
                </div>
                <br/>
                <span>Sharp/Flat:</span>
                <div id="sharpOrFlat" class="btn-group btn-group-toggle" role="group">
                    <button onclick="selectNote('sharp')" class="btn btn-secondary">sharp/#</button>
                    <button onclick="selectNote('natural')" class="btn btn-secondary"> </button>
                    <button onclick="selectNote('flat')" class="btn btn-secondary">flat/♭</button>
                </div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button onclick="addNodeSubmit()" type="button" class="btn btn-primary" data-dismiss="modal" data-toggle="collapse">Save changes</button>
            </div>
        </div>
        </div>
        </div>
        <div class="row align-items-center">
             <!-- Toolbox Section -->
            <div class="col-2" id="toolbox">
                <h3>Toolbox</h3>
                <span>Click a node and drag the edge to another node to connect them.</span>
                <br/><br/>
                <button type="button" class="btn btn-primary" data-toggle="modal" data-toggle="collapse" data-target="#noteModal">
                    <i class="fa fa-plus"></i>
                    Add Node
                </button>
                <br/><br/>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <button type="button" class="btn btn-outline-primary" disabled>
                        <i class="fa fa-chevron-right"></i>
                        Add Edge
                    </button>
                    <label class="btn btn-secondary">
                        <input type="radio" onchange="toggleAddEdge(true)" class="btn btn-secondary" autocomplete="off" checked>On</button>
                    </label>
                    <label class="btn btn-secondary">
                        <input type="radio" onchange="toggleAddEdge(false)" class="btn btn-secondary" autocomplete="off">Off</button>
                    </label>
                </div>
                <br/><br/>
                <button type="button" data-toggle="tooltip" data-placement="top" title="Edit Node" class="btn btn-warning">
                    <i class="fa fa-pencil"></i>
                    Node
                </button>
                <button type="button" data-toggle="tooltip" data-placement="top" title="Edit Edge" class="btn btn-warning" disabled>
                    <i class="fa fa-arrows"></i>
                    Edge
                </button>
                <br/><br/>
                <button type="button" class="btn btn-danger" disabled>
                    <i class="fa fa-trash"></i>
                    Delete Node
                </button>
                <br/><br/>
                <button type="button" class="btn btn-primary" onclick="playPressed()">
                    <i class="fa fa-play"></i>
                    Play Music Mode
                </button>
            </div>
            <!-- Network Display Section -->
            <div class="col-10" id="musicNetwork"></div>
        </div>
        <div class="row">
            <pre id="eventSpan"></pre>
        </div>
    </div>

    <script type="text/javascript">
        // Set-up
        let current_note = ['C',''];
        let root_node;
        let current_node;
        let edgeMode = false;
        
        var locales = {
            music: {
                edit: 'Edit',
                del: 'Delete selected note',
                back: 'Back',
                addNode: 'Add Node',
                addEdge: 'Add Edge',
                editNode: 'Edit Node',
                editEdge: 'Edit Edge',
                addDescription: 'Click in an empty space to place a new node.',
                edgeDescription: 'Click on a node and drag the edge to another node to connect them.',
                editEdgeDescription: 'Click on the control points and drag them to a node to connect to it.',
                createEdgeError: 'Cannot link edges to a cluster.',
                deleteClusterError: 'Clusters cannot be deleted.',
                editClusterError: 'Clusters cannot be edited.'
            }
        }

        // create an array with nodes
        var nodes = new vis.DataSet([
            {id: 1, label: 'A', instrument: 'ggez'},
            {id: 2, label: 'C#'},
            {id: 3, label: 'B'},
            {id: 4, label: 'E♭'},
            {id: 5, label: 'G'}
        ]);

        // create an array with edges
        var edges = new vis.DataSet([
            {from: 1, to: 3},
            {from: 1, to: 2},
            {from: 2, to: 4},
            {from: 2, to: 5}
        ]);

        // node functions set-up 
        function selectNote(note) {
            switch (note) {
                case 'sharp':
                    current_note[1] = "#";
                    console.log(current_note);
                    break;
                case 'flat':
                    current_note[1] = "♭";
                    console.log(current_note);
                    break;
                case 'natural':
                    current_note[1] = "";
                    console.log(current_note);
                    break;
                default:
                    current_note[0] = note;
                    console.log(current_note);
                    break;
            }
        }
        function addNodeSubmit() {
            network.enableEditMode();
            if (current_note[0] != '') {
                nodeList = nodes.get({fields: ['id', 'label']});
                nodes.add([
                    {id: nodeList.length+1, label: current_note[0] + current_note[1]}
                ]);
                document.getElementById("instructionText").style.display = "block";
            }
        }
        function toggleAddEdge(bool) {
            if (bool) {
                edgeMode = true;
                network.enableEditMode();
                network.addEdgeMode();
            }
            else {
                edgeMode = false;
                network.disableEditMode();
            }
        }
        function playPressed() {
            nodeList = nodes.get({fields: ['id', 'label']});
            edgeList = edges.get({fields:["from", "to"]});
            var randomRoot = nodeList[Math.floor(Math.random()*nodeList.length)];
            console.log(randomRoot.label);
        }

        // create a network
        var container = document.getElementById('musicNetwork');

        // provide the data in the vis format
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
            interaction: { hover: true },
            interaction: {
                navigationButtons: true,
                keyboard: true
            },
            manipulation: {
                enabled: true,
                addNode: function(nodeData,callback) {
                    current_note = prompt("Please enter note");
                    if (current_note != "") {
                        console.log(nodeData);
                        nodeData.label = current_note;
                        callback(nodeData);
                    }
                },
                addEdge: function(edgeData,callback) {
                    edgeList = edges.get({fields: ['from', 'to']});
                    if ({from: edgeData.from, to: edgeData.to})
                    if (edgeData.from === edgeData.to) {
                        var r = confirm("Do you want to connect the node to itself?");
                        if (r === true) {
                        callback(edgeData);
                        }
                    }
                    else {
                        callback(edgeData);
                    }
                    if (edgeMode) {
                        network.addEdgeMode();
                    }
                },
                addNode: function(nodeData,callback) {
                    current_note = prompt("Please enter note");
                    if (current_note != "") {
                        console.log(nodeData);
                        nodeData.label = current_note;
                        callback(nodeData);
                    }
                },
                editNode: function(nodeData,callback) {
                    nodeData.label = 'A';
                    callback(nodeData);
                },
                controlNodeStyle: {
                    //Styling here dab
                }
            },
            locales: locales,
            locale: "music",
        };

        // initialize your network!
        var network = new vis.Network(container, data, options);
        network.on("click", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>Click event:</h2>" + JSON.stringify(params, null, 4);
            console.log(
                "click event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM)
            );
        });
        network.on("doubleClick", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>doubleClick event:</h2>" + JSON.stringify(params, null, 4);
        });
        network.on("oncontext", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML = 
                "<h2>oncontext (right click) event:</h2>" + JSON.stringify(params, null, 4);
        });
        network.on("dragStart", function (params) {
            // There's no point in displaying this event on screen, it gets immediately overwritten
            params.event = "[original event]";
            console.log("dragStart Event:", params);
            console.log(
                "dragStart event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM)
            );
        });
        network.on("dragging", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>dragging event:</h2>" + JSON.stringify(params, null, 4);
        });
        network.on("dragEnd", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>dragEnd event:</h2>" + JSON.stringify(params, null, 4);
            console.log("dragEnd Event:", params);
            console.log(
                "dragEnd event, getNodeAt returns: " + this.getNodeAt(params.pointer.DOM)
        );
        });
        network.on("controlNodeDragging", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>control node dragging event:</h2>" + JSON.stringify(params, null, 4);
        });
        network.on("controlNodeDragEnd", function (params) {
            params.event = "[original event]";
            document.getElementById("eventSpan").innerHTML =
                "<h2>control node drag end event:</h2>" + JSON.stringify(params, null, 4);
            console.log("controlNodeDragEnd Event:", params);
        });
        network.on("zoom", function (params) {
            document.getElementById("eventSpan").innerHTML =
                "<h2>zoom event:</h2>" + JSON.stringify(params, null, 4);
        });
        network.on("showPopup", function (params) {
            document.getElementById("eventSpan").innerHTML =
                "<h2>showPopup event: </h2>" + JSON.stringify(params, null, 4);
        });
        network.on("hidePopup", function () {
            console.log("hidePopup Event");
        });
        network.on("select", function (params) {
            console.log("select Event:", params);
        });
        network.on("selectNode", function (params) {
            // THIS IS WHEN YOU SELECT A NODE
            root_node_index = params["nodes"][0];
            neighboring_nodes = network.getConnectedNodes(root_node_index);
            //PLAY it her

            // code for go to a random neighboring node, aka change root_node to neighbor 

            // root_node_index is actually a string for some reason? Whack
            console.log("Root node selected. Index: " + root_node_index + ". Neighbors: " + neightboring_nodes);
            console.log("selectNode Event:", params);
        });
        network.on("selectEdge", function (params) {
            console.log("selectEdge Event:", params);
        });
        network.on("deselectNode", function (params) {
            console.log("deselectNode Event:", params);
        });
        network.on("deselectEdge", function (params) {
            console.log("deselectEdge Event:", params);
        });
        network.on("hoverNode", function (params) {
            console.log("hoverNode Event:", params);
        });
        network.on("hoverEdge", function (params) {
            console.log("hoverEdge Event:", params);
        });
        network.on("blurNode", function (params) {
            console.log("blurNode Event:", params);
        });
        network.on("blurEdge", function (params) {
            console.log("blurEdge Event:", params);
        });
    </script>
</body>
</html>